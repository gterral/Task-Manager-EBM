{% extends "@EBMGDP/bundleLayout.html.twig" %}

{# Titre de l'onglet #}
{% block title %}
    Gestion de projet
{% endblock %}

{# CSS propres � cette page #}
{% block stylesheets %}

    {%  stylesheets filter='cssrewrite,scssphp'
    'bundles/coreiconbar/theme/global/vendor/datatables-bootstrap/dataTables.bootstrap.css'
    'bundles/coreiconbar/theme/global/vendor/datatables-fixedheader/dataTables.fixedHeader.css'
    'bundles/coreiconbar/theme/global/vendor/datatables-responsive/dataTables.responsive.css'
    %}
    <link rel="stylesheet" href="{{ asset_url }}" type="text/css" />
    <style>
        #tasks-action .input-search {
            display: inline-block;
            vertical-align: middle;
        }
        #searchField {
            height: 35px;
        }
        .panel-actions a {
            color:#757575;
        }
    </style>
    {% endstylesheets %}

{% endblock %}


{# Contenu de la page #}

{% block content_body %}

    <div class="panel panel-bordered panel-primary">

        {# Header : titre + barre de recherche sur le tableau #}
        <div class="panel-heading">
            <h3 class="panel-title">Task List - {{ project.name|upper }}</h3>
            <div class="panel-actions" id="tasks-action">
                <div class="input-search input-group-sm">
                    <button type="submit" class="input-search-btn"><i class="icon md-search" aria-hidden="true" style="color: #757575!important;"></i> </button>
                    <input type="text" class="form-control" name="" placeholder="Rechercher..." id="searchField">
                </div>
                &nbsp;
                <a href="{{ path('ebmgdp_task_add', {'code':project.code}) }}" class="btn btn-round btn-default waves-effect waves-round">Ajouter une tâche</a>
            </div>
        </div>

        {# Tableau #}
        {%  if listTasks is null or listTasks|length == 0 %}
            <p class="margin-20 text-center">Aucune tâche n'a été définie pour ce projet</p>
        {% else %}
            {% include "EBMGDPBundle:Task/components:tasksTable.html.twig" %}
        {% endif %}

    </div>

{% endblock %}


{# Scripts propres � cette page #}
{% block scripts %}

    <script src="http://cdn.datatables.net/1.10.7/js/jquery.dataTables.min.js"></script>

    {% javascripts filter='jsqueeze'
    'bundles/coreiconbar/theme/global/vendor/datatables-fixedheader/dataTables.fixedHeader.js'
    'bundles/coreiconbar/theme/global/vendor/datatables-bootstrap/dataTables.bootstrap.js'
    'bundles/coreiconbar/theme/global/vendor/datatables-responsive/dataTables.responsive.js'
    'bundles/coreiconbar/theme/global/vendor/datatables-tabletools/dataTables.tableTools.js'
    %}
    <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}

    <script type="text/javascript">

        $( document ).ready(function() {

            $(".task-status").change(function () {

                var status = $(this).find(':selected').data('status');
                var task_id = $(this).find(':selected').data('task');

                var postData = {"status":status,'task_id':task_id};

                var route = "{{ path('ebmgdp_task_edit_status', {'code':project.code}) }}";

                $.post( route, postData ,function( data ) {
                });

            });


            $("#tasksTable").DataTable({
                "destroy":true,
                "paging": false,
                "lengthChange": false,
                "searching": true,
                "ordering": true,
                "info": false,
                "autoWidth": false,
                "order": [[ 2, "desc" ],[ 1, "desc" ]]
            });

            // Recherche depuis champ de recherche du header panel
            $("#searchField").on('keyup', function (){
                $('#tasksTable').dataTable().fnFilter(this.value);
            });

        });



    </script>

{% endblock %}
